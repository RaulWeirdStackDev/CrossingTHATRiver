<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#007bff">
    <title>Crossing THAT River</title>
    <link rel="stylesheet" href="./introStyle.css">
    <link rel="shortcut icon" href="./assets/img/wolf.png" type="image/x-icon">
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./pwa/icon-192.png">
</head>
<body class="introBody">
    <div class="buttonContainer">
        <a href="./game/game.html" class="navButton">
            <img src="./assets/img/btnStart.png" alt="Start">
        </a>

        <a href="./score/hiScores.html" class="navButton">
            <img src="./assets/img/btnScore.png" alt="Scores">
        </a>
    </div>
    
    <button id="btnInstrucciones" class="button-instrucciones">
        üìã Instrucciones
    </button>

    <!-- Modal de Instrucciones -->
    <div id="modalInstrucciones" class="modal">
        <div class="modal-content-instrucciones">
            <button class="modal-close" id="closeInstrucciones">&times;</button>
            <img src="./assets/img/instrucciones.png" alt="Instrucciones del juego" class="instrucciones-img">
        </div>
    </div>

    <!-- Scripts -->
    <script src="./modal.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js', {
                        scope: '/',
                        updateViaCache: 'none'
                    });

                    console.log('‚úÖ SW registrado:', registration.scope);

                    // Auto-actualizaci√≥n cada 30s
                    setInterval(() => registration.update(), 30000);

                    // Detectar nueva versi√≥n
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker?.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // Nueva versi√≥n disponible
                                console.log('üîÑ Nueva versi√≥n disponible');
                                if (confirm('¬°Hay una actualizaci√≥n! ¬øRecargar ahora?')) {
                                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                                    window.location.reload();
                                }
                            }
                        });
                    });

                    // Recargar cuando el nuevo SW tome control
                    navigator.serviceWorker.addEventListener('controllerchange', () => {
                        window.location.reload();
                    });

                } catch (error) {
                    console.error('‚ùå Error registrando SW:', error);
                }
            });
        }
    </script>
</body>
</html>